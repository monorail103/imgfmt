# IMG_format_converter
Cloudflare Workers上で動作することを前提とした、画像フォーマット・サイズを変換するツール。

## 技術スタック
- Rust
- Cargo
- Cloudflare Workers
- Cloudflare R2(オブジェクトストレージ)

## 概要
このアプリケーションは、画像編集機能と保存機能の２つに分かれます。以下に概要を記します。
### 画像編集
- サイズ指定で画像リサイズ。
- APIだけでは使いづらいため、簡易的なUI（HTML）を提供。
- 画像フォーマット変換。jpeg, png, webp, bmp, gifなどの画像フォーマットに対応。
- 【JPG限定の機能】画像の品質を指定して変換。

### 保存機能
- Cloudflare R2に保存
- IPアドレスによる、一連の処理についての回数制限
- 指数関数的バックオフ処理によるアップロード処理
- 画像編集時に設定するパスワードにより、削除機能の利用が可能。
- 有効期限を設定し、自動的に削除される。

## 保存機能の詳細
### R2に保存
画像をR2に保存する際、ファイル名はランダムな文字列で生成されます。UUIDと日付タイムスタンプを組み合わせた形式で、uniqueなファイル名を生成します。  
保存と同時に、D1にファイル名と有効期限、パスワードを保存します。パスワードは`bcrypt`でハッシュ化され、保存されます。

### 削除機能
保存時に設定したパスワードを使って、R2からファイルを削除することができます。
削除は、HTTP POSTリクエストで行います。パスワードが正しい場合、R2からファイルを削除し、D1からもレコードを削除します。
なお、D1のフラグなどを用いて表面上の削除だけでなく、ファイル自体が削除されます。


